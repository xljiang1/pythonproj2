A service is encountering gw_gen=T svcError=java.io.EOFException status=503. How to resolve this ?
Example Gateway Log:

txId=b8583423-1b28-41d3-90d6-c97974676077, izone=enterprise, env=prd, rev=15, app=Intuit.platform.financialdataplatform.fdpenhanceservice, appType=web, authType=intuitPrivatePlusUser, credentialId=3172803529782107944, authTime=0, ticketConversion=cbt2cbt, userContext=eyJraWQi, userAAL=25, albRedirect=F, method=GET, xHost=financialaccount-aws.api.intuit.com, port=18379, api=Intuit.platform.financialdataplatform.financialaccount, req=/default/v1/realms/123146382749889/accountOwnerships, corsActive=false, requestContentType=application/json, requestSize=0, outboundHostname=fdp-aggregation-prd-financial-account-root.ifdp-prod-usw2.iks.a.intuit.com, status=503, phrase=Code:DownStreamServiceUnavailable,Type:SYSTEM, gw_gen=T, portlessRouting=T, gwTime=2, svcTime=3, txTime=5, xFor=34.212.93.59, 34.215.229.17, 100.127.181.0, 54.71.140.184, routeInboundURI=/default/v1/, routingType=serviceDial, swimlane=Default - Single Swimlane/Default - All Traffic, offeringId=Intuit.sbg.payments.account, CEH=F, CLIENT_AAL=15, EmbargoedIpPolicy=0, TP=F, b3In=T, cbtTime=0, expDateMillis=1583193600000, gwAZ=us-west-2c, gwDC=usWest2, gwErrorType=S, httpResponseCode=503, iamProduct=0, intuitAgentId=9130346587402286, intuitUserId=9130346587402286, lastMileSigning=generated, lmSigningTime=0, nsId=50000001, offTkt=true, offlineTicket=0, outReqUri=/v1/realms/123146382749889/accountOwnerships, outboundCipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256, partitionId=7add9e76-71c7-47e4-88f4-1add85c1feec, partitionName=sw30, privateAuthPlusTime=0, reqFiltered=/default/v1/realms//accountOwnerships, reqInboundURI=/default/v1/*, skipAccountMergeFlow=true, svcError=java.io.EOFException HttpConnectionOverHTTP@d0798f9::DecryptedEndPoint@1d7e6737{l=/10.91.162.241:56854,r=fdp-aggregation-prd-financial-account-root.ifdp-prod-usw2.iks.a.intuit.com/52.39.119.124:443

The error is generated by Gateway. However, gwErrorType=S which means the error is related to the service. This exception is caused by The connection to backend service was closed unexpectedly. Typically, this means either backend server or load balancer is closing the connection without sending response back to Gateway.

A possible solution includes checking the backend load balancer and servers. A packet capture on these two hops will help. PI Team can help in capturing the Packet on Load balancer.

It is not recommended to capture packets or flow logs on the gateway side since the amount of traffic is substantial making it difficult to match up the request in question.

How to make APIs of your service available offline ?
This process is self-service and done through the YAML configuration in Dev Portal. For reference the steps are below:

Navigate to the service's Gateway YAML configuration in Dev Portal.
Add the offline scope, i.e. API, under scopes per the documentation (type: iam).
Save and start a workflow.
Have another team member with at least DevOps permission approve and go live.
How to resolve 403 errors from Gateway?
There are three types of 403 errors generated by gateway:

App is not onboarded to the service, i.e. app_onboarded=false in the logs.
App is blocked due to a grant not having sufficient permission to access a service's API.
App is not onboarded to a service's offline API or invalid offline ticket (offTkt will be non-zero).
App is not onboarded to the service, status=403, gw_gen=T, gwErrorType=C, app_onboarded=false
When checking the logs, you will find a log field app_onboarded=false which means Gateway is rejecting the client's request because the client is not onboarded to the service. Solution is to ask the customer to onboard the client to the service.

App is blocked due to a grant, status=403, gw_gen=T, gwErrorType=C, "App not authorized due to grant"
When an app is blocked due to a grant, the service owner must either update the currently assigned grant to allow more permission via the YAML, or assign a different existing grant to the app.

Offline Ticket Errors, status=403, gw_gen=T, gwErrorType=C, phrase=Code:ApplicationAuthorizationFailed,Message:unauthorized offline ticket
When offTkt > 0, the 403 is due to an offline ticket request. For possible solutions, please refer to Common Offline Processing Errors. Typically the errors result from the app not being onboarded to the service's offline API, the offline ticket is expired, or the offline ticket was created with an incorrect audience (client asset ID).

Example Gateway Log

Asset Alias: OPJ service Intuit.payroll.payrolltax.onlinepayrolljobs Asset Id: 1227248490763480237. tid=a5ee496d-24ed-45b7-b895-23ac1cc8c9c6 LogPublisherImpl level=INFO txId=4995b689-d768-480c-9110-4f3d7fe3bcbf, izone=enterprise, env=e2e, rev=14, app=Intuit.payroll.payrolltax.onlinepayrolljobs, authType=intuitPrivatePlusUser, credentialId=6198096579480451884, authTime=0, userContext=eyJraWQi, albRedirect=F, method=POST, xHost=onlinepayrolljobs-e2e.api.intuit.com, port=45204, api=Intuit.payroll.payrolltax.onlinepayrolljobs, req=/preview/v1/batchjobprocessing/ftuEmailSeriesPayrollHistoryEventTask, corsActive=false, status=403, phrase=Code:ApplicationAuthorizationFailed,Message:unauthorized offline ticket,Type:SYSTEM, gw_gen=T, portlessRouting=T, txTime=1, xFor=54.218.172.218, offeringId=JOB_SCHEDULING_SERVICE_OFFERING_ID, key='authorization', reason='offlineTicket', message='Unauthorized Offline Ticket', CEH=F, EmbargoedIpPolicy=0, expDateMillis=1561593600000, grntAAL=null, grntAALTyp=null, gwAZ=us-west-2a, gwDC=usWest2, gwErrorType=C, httpResponseCode=403, offlineTicket=1, outReqUri=/test/jss/v1/batchjobprocessing/ftuEmailSeriesPayrollHistoryEventTask, partitionId=414c37dc-edb3-4eae-92e5-d7e3e3673e8b, partitionName=sw4, privateAuthPlusTime=0, reqFiltered=/preview/v1/batchjobprocessing/ftuEmailSeriesPayrollHistoryEventTask, reqInboundURI=/preview/v1/*, uniqueId=1-60073143-3812a2112bad6e6a3f2ae933, user-agent=Java/1.8.0_252, x-amzn-trace-id=Root=1-60073143-3812a2112bad6e6a3f2ae933

How to configure App based Dialing for a service for a particular environment?
Currently this is not self-service for specific clients. The steps are below for using the Registry CLI:

Get the available swimlane configurations in JSON format python -m registry_cli services list_service_dial -h aws -s <service_asset_id> -e <environment>

python -m registry_cli services list_service_dial -h aws -s 1154064996702269815 -e e2e
[INFO   ](client_factory.py:44) To use local registry. use export REGISTRY_CLI_ENV=local
!!! Are you ok to proceed in prod env (choose: 'Y', 'y', 'YES', 'yes' to procced.): y
using prd registry with endpoint https://serviceregistry.platform.intuit.com/v1
[E2E WRITE Traffic Split]: Write IKS - 0
[E2E WRITE Traffic Split]: Write IHP - 100
[E2E READ Traffic Split]: READ IKS - 0
[E2E READ Traffic Split]: READ IHP - 100
[RTB READ Traffic Split]: IKS - 0
[RTB READ Traffic Split]: IHP - 100
[Default - Single Swimlane]: Default - All Traffic - 100
[INFO   ](common.py:531) Data successfully saved to /tmp/1154064996702269815-e2e-rev105-E2E WRITE Traffic Split.json
[INFO   ](common.py:531) Data successfully saved to /tmp/1154064996702269815-e2e-rev105-E2E READ Traffic Split.json
[INFO   ](common.py:531) Data successfully saved to /tmp/1154064996702269815-e2e-rev105-RTB READ Traffic Split.json
[INFO   ](common.py:531) Data successfully saved to /tmp/1154064996702269815-e2e-rev105-Default - Single Swimlane.json
Success! (No news is good news.)
Update and save the file that is specific to the Target Group with the correct percentages for each swimlane.

{
  "targetGroup": {
    "name": "RTB READ Traffic Split",
    "weights": [
      {
        "name": "IKS",
        "weight": 0
      },
      {
        "name": "IHP",
        "weight": 100
      }
    ]
  }
}
Run this command to perform traffic dialing for the app.
How to resolve Route not found, status=404?
If the error is generated by Gateway (gw_gen=T), that means there is no configured service route that matches the client's request. Verify the service's YAML config for that revision against the endpoint the client is calling.

If the error is generated by the service (gw_gen=F), that means the service's API does not recognize the URI.

